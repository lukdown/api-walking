<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ksb">

	
	<!-- 회원 정보 가져오기 -->
	<select id="selectMemberInfo" resultType="KsbVo" parameterType="int">
		<![CDATA[
			select  users_no,
					users_id,
					users_pw,
					users_name,
					users_nickname,
					users_hp,
					users_birth_date,
					users_gender,
					users_residence,
					users_filePath as 'filePath',
					users_orgName as 'orgName',
					users_saveName as 'saveName',
					users_fileSize as 'fileSize',
					users_login_type
			from users_list
			where users_no = #{no}
		]]>
	</select>
	
	<!-- 프로필 사진 업데이트 -->
	<update id="profileUpdate" parameterType="ksbVo">
		<![CDATA[
			update users_list
			set users_saveName = #{saveName},
				users_orgName = #{orgName},
			    users_fileSize = #{fileSize},
			    users_filePath = #{filePath}
			where users_no = #{users_no}
		]]>
	</update>
	
	
	<!-- 기록 리스트 가져오기 -->
	<select id="recordList" parameterType="int" resultType="KsbVo">
		<![CDATA[
			select  record_no,
					users_no,
			        course_no,
			        record_date,
			        record_time,
			        record_length,
			        record_kcal,
			        record_vibe,
			        record_memo
			from record
			where users_no = #{no}
			order by record_date
		]]>
	
	</select>
	
	<!-- 달력 리스트 가져오기 -->
	<select id="calendarList" parameterType="int" resultType="KsbVo">
		<![CDATA[
			select  record_no,
					users_no,
			        course_no,
			        record_date,
			        record_time,
			        record_length,
			        record_kcal,
			        record_vibe,
			        record_memo
			from record
			where users_no = #{no}
		]]>	
	</select>
	
	
	<!-- 코스 포인트 가져오기 -->
	<select id="coursepointList" parameterType="ksbVo" resultType="KsbVo">
		<![CDATA[
			SELECT course_point_no, course_no, course_latitude, course_longitude, course_order, course_division,
			       @group_num := IF(@last_val = 0 AND course_order != 0, @group_num + 1, @group_num) AS group_num,
			       @last_val := course_order
			FROM (
			    SELECT course_point_no, course_no, course_latitude, course_longitude, course_order, course_division
			    FROM course_point
			    ORDER BY course_point_no
			) AS sorted_numbers
			where course_no = #{course_no}
			
		]]>
	</select>
	
	<!-- 기록 포인트 가져오기 -->
	<select id="recordpointList" parameterType="ksbVo" resultType="KsbVo">
		<![CDATA[
			SELECT record_point_no, record_no, record_latitude, record_longitude, record_order, record_division,
			       @group_num := IF(@last_val = 0 AND record_order != 0, @group_num + 1, @group_num) AS group_num,
			       @last_val := record_order
			FROM (
			    SELECT record_point_no, record_no, record_latitude, record_longitude, record_order, record_division
			    FROM record_point
			    ORDER BY record_point_no
			) AS sorted_numbers
			where record_no = #{record_no}  
		
		
		]]>
		
	</select>
	
</mapper>